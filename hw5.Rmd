---
title: "Homework 6"
author: "Alyssa Vanderbeek (amv2187)"
date: "3 December 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(faraway)
library(HH)
```

```{r}
states = state.x77 %>% # load data from faraway package
  as.data.frame() %>%
  janitor::clean_names()
```

**1. Explore the dataset and generate appropriate descriptive statistics and relevant graphs for all variables of interest (continuous and categorical) – no test required. Be selective! Even if you create 20 plots, you don’t want to show them all.**

```{r}

# table of summary stats
states %>%
  skimr::skim_to_list() %>%
  as.data.frame %>%
  dplyr::select(1, 2, 5:11) %>%
  `colnames<-`(c(' ', 'NA', 'Mean', 'Std. Dev.', 'Min', '1st Q', 'Median', '3rd Q', 'Max')) %>%
  knitr::kable()

# scatterplot to assess correlation between vars
states %>%
  pairs

# correlation matrix to evaluate what is seen in scatterplots
states %>%
  cor
```

It looks like murder is correlated both with life expectancy and illiteracy, suggesting that it is a potential confounder. Specifically, murder is positively associated with illiteracy (higher murder rate = higher illiteracy rate) and negatively associated with life expectancy (higher murder rate = lower life expectancy).

After examining the distribution of each vriable in the dataset, I chose to perform a log transformation on the estimates for area size, illiteracy rate, and population size, which were all skewed. 

```{r}
states_analysis = states %>%
  mutate(log_area = log(area),
         log_illiteracy = log(illiteracy),
         log_popn = log(population)) %>%
  dplyr::select(-area, -population, -illiteracy)

par(mfrow = c(2, 3))
hist(states$illiteracy)
hist(states$population)
hist(states$area)
hist(states_analysis$log_illiteracy)
hist(states_analysis$log_popn)
hist(states_analysis$log_area)

```


**2. Use automatic procedures to find a ‘best subset’ of the full model. Present the results and comment on the following**

```{r}
## backwards elimination
summary(lm(life_exp ~ ., data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + frost + log_area + log_illiteracy + log_popn, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + frost + log_illiteracy + log_popn, data = states_analysis))

b.fit = lm(life_exp ~ murder + hs_grad + frost + log_popn, data = states_analysis)
summary(b.fit)


## forwards process
summary(lm(life_exp ~ murder, data = states_analysis))
summary(lm(life_exp ~ hs_grad, data = states_analysis))
summary(lm(life_exp ~ frost, data = states_analysis))
summary(lm(life_exp ~ log_area, data = states_analysis))
summary(lm(life_exp ~ log_illiteracy, data = states_analysis))
summary(lm(life_exp ~ log_popn, data = states_analysis))

# murder has lowest p-val. Start adding secondary vars
summary(lm(life_exp ~ murder + hs_grad, data = states_analysis))
summary(lm(life_exp ~ murder + frost, data = states_analysis))
summary(lm(life_exp ~ murder + log_area, data = states_analysis))
summary(lm(life_exp ~ murder + log_illiteracy, data = states_analysis))
summary(lm(life_exp ~ murder + log_popn, data = states_analysis))

# murder + hs_grad
summary(lm(life_exp ~ murder + hs_grad + frost, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + log_area, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + log_illiteracy, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + log_popn, data = states_analysis))

# murder + hs_grad + log_popn
summary(lm(life_exp ~ murder + hs_grad + log_popn + frost, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + log_popn + log_area, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + log_popn + log_illiteracy, data = states_analysis))

# murder + hs_grad + log_popn + frost
summary(lm(life_exp ~ murder + hs_grad + log_popn + frost + log_area, data = states_analysis))
summary(lm(life_exp ~ murder + hs_grad + log_popn + frost + log_illiteracy, data = states_analysis))

f.fit = lm(life_exp ~ murder + hs_grad + log_popn + frost, data = states_analysis)
summary(f.fit)


## Stepwise
step.fit = step(lm(life_exp ~ ., data = states_analysis))

```

All automatic processes conclude the same model, using percent increase in population size (log(population)), rate of high school graduation (hs_grad), murder rate per 100,000 (murder), and average number of days annually with temperatures below freezing (frost) as predictors of life expectancy. 

'Frost' is the least significant predictor, with a p-value of 0.043. No variables were seen to be a "close call" at the 5% significance level.

There is a correlation between illiteracy (with and without log transformation) and high school graduation rate (`r cor(states$illiteracy, states$hs_grad)`), but my model includes only high school graduation rate as a predictor.

**3. Use criterion-based procedures studied in class to guide your selection of the ‘best subset’. Summarize your results (tabular or graphical)**
